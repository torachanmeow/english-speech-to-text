<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy"
          content="
            default-src 'self';
            script-src 'self' 'unsafe-inline' https://code.jquery.com https://cdn.jsdelivr.net;
            style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
            font-src 'self' https://cdn.jsdelivr.net;
            connect-src 'self' https://generativelanguage.googleapis.com https://cdn.jsdelivr.net;">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Speech to Text</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
          crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet"
          integrity="sha384-QuGBSgV5Im3DzL2z+8Ko9/hqNy/N0O7zwvXAtfd1MvPKWa/UbeLV65cfm4BV5Wgq"
          crossorigin="anonymous">
    
    <!-- Custom CSS -->
    <link href="css/main.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid app-container">
        <!-- Header: 設定・コントロールエリア -->
        <header class="row bg-light border-bottom py-3">
            <div class="col-md-4 d-flex align-items-center">
                <!-- 言語選択 -->
                <div class="btn-group" role="group" aria-label="言語選択">
                    <input type="radio" class="btn-check" name="language" id="en-us" value="en-US" checked>
                    <label class="btn btn-outline-primary btn-lg" for="en-us">English (US)</label>
                    
                    <input type="radio" class="btn-check" name="language" id="en-gb" value="en-GB">
                    <label class="btn btn-outline-primary btn-lg" for="en-gb">English (UK)</label>
                </div>
            </div>
            
            <div class="col-md-4 text-center">
                <!-- 音声認識ボタン -->
                <button id="recognition-btn" class="btn btn-secondary btn-lg">
                    <i class="bi bi-mic-fill me-2"></i>
                    <span id="btn-text">音声認識</span>
                </button>
            </div>
            
            <div class="col-md-4 text-end">
                <!-- クイック翻訳ボタン -->
                <button type="button" class="btn btn-outline-secondary me-2" id="translation-area-toggle">
                    <i class="bi bi-eye me-1"></i>クイック翻訳
                </button>
                
                <!-- テーマ切り替え -->
                <button type="button" class="btn btn-outline-secondary me-2" id="theme-toggle">
                    <i class="bi bi-moon-fill me-2" id="theme-icon"></i>テーマ
                </button>
                
                <!-- 設定ボタン -->
                <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#settingsModal">
                    <i class="bi bi-gear me-2"></i>設定
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="row flex-grow-1">
            <div class="col-12">
                <!-- 音声認識結果表示エリア -->
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <h6 class="mb-0 me-3">音声認識結果</h6>
                            <button id="auto-scroll-toggle" class="btn btn-outline-success btn-sm me-2">
                                <i class="bi bi-arrow-down-circle me-1"></i>自動スクロール
                            </button>
                            <button id="auto-translate-toggle" class="btn btn-outline-success btn-sm me-2">
                                <i class="bi bi-translate me-1"></i>自動翻訳
                            </button>
                        </div>
                        <button id="clear-text-btn" class="btn btn-outline-secondary btn-sm">
                            <i class="bi bi-trash me-1"></i>クリア
                        </button>
                    </div>
                    <div class="card-body main-text-area p-3" id="main-text">
                        <!-- 初期メッセージはJavaScriptで動的に生成 -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Translation Area -->
        <footer class="row mt-3">
            <div class="col-12">
                <div id="translation-display" class="card">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="bi bi-search me-2"></i>クイック翻訳</h6>
                    </div>
                    <div class="card-body">
                        <!-- 手動翻訳入力 -->
                        <div class="mb-3">
                            <div class="input-group">
                                <input type="text" id="manual-translation-input" class="form-control" placeholder="翻訳したいテキストを入力してください">
                                <button id="translate-btn" class="btn btn-success" type="button">
                                    <i class="bi bi-translate me-1"></i>翻訳
                                </button>
                            </div>
                        </div>
                        
                        <div class="translation-placeholder text-muted text-center py-3">
                            音声認識したテキストを選択すると翻訳入力欄にコピーされます
                        </div>
                        <!-- 選択時に表示 -->
                        <div class="translation-content d-none">
                            <div class="text-line" data-translation-item="original">
                                <small class="text-muted">原文</small>
                                <div class="translation-text-content selected-text"></div>
                            </div>
                            <div class="text-line" data-translation-item="translated">
                                <small class="text-muted">翻訳</small>
                                <div class="translation-text-content translated-text"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="settingsModalLabel">設定</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="settings-form">
                        <div class="mb-3">
                            <label for="gemini-api-key" class="form-label">Gemini APIキー</label>
                            <input type="password" class="form-control" id="gemini-api-key" placeholder="APIキーを入力してください">
                        </div>
                        
                        <div class="mb-3">
                            <label for="gemini-model" class="form-label">Geminiモデル</label>
                            <select class="form-select" id="gemini-model">
                                <option value="gemini-2.5-flash-lite" selected>Gemini 2.5 Flash-Lite</option>
                                <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash-Lite</option>
                                <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                                <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="max-text-lines" class="form-label">最大表示行数</label>
                            <input type="number" class="form-control" id="max-text-lines" value="50" min="0" max="200">
                            <div class="form-text">表示する最大行数（0=無制限、1-200=制限あり）</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="translation-description" class="form-label">翻訳スタイル（任意）</label>
                            <textarea class="form-control" id="translation-description" rows="3" placeholder="例: 女性的な話し方、くだけた口調、関西弁、丁寧語、若者言葉など"></textarea>
                            <div class="form-text">翻訳時のスタイルや口調を指定。空欄の場合は標準的な翻訳を行います</div>
                        </div>
                        
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
                    <button type="button" class="btn btn-primary" id="save-settings">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Toast -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="loading-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <div class="spinner-border spinner-border-sm me-2" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <strong class="me-auto">処理中</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                翻訳処理中です...
            </div>
        </div>
    </div>

    <!-- Error Toast -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="error-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header text-danger">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <strong class="me-auto">エラー</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="error-message">
                エラーが発生しました
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha384-1H217gwSVyLSIfaLxHbE7dRb3v4mYCKbpQvzx0cegeju1MVsGrX5xXxAvs/HgeFs"
            crossorigin="anonymous"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
            crossorigin="anonymous"></script>  
    
    <!-- Application Scripts -->
    <script src="js/utils/utils.js"></script>
    <script src="js/config/settings.js"></script>
    <script src="js/modules/stateManager.js"></script>
    <script src="js/modules/speechRecognition.js"></script>
    <script src="js/modules/translator.js"></script>
    <script src="js/modules/uiController.js"></script>
    <script src="js/main.js"></script>
</body>
</html>